<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢¨å¢¨è¯´-volatileå…³é”®å­—</title>
    <style>
        body {
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            background-color: #F5F0FF;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        .card {
            width: 450px;
            height: 600px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .header {
            height: 20px;
            background: linear-gradient(90deg, #8E6BFF, #6B8EFF);
            position: relative;
        }
        .header::before {
            content: "";
            position: absolute;
            width: 10px;
            height: 20px;
            background: #6BFF8E;
            border-radius: 0 5px 5px 0;
        }
        .content {
            padding: 20px;
            flex: 1;
            overflow: hidden;
        }
        .footer {
            height: 60px;
            background: linear-gradient(90deg, #6B8EFF, #8E6BFF);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        h1 {
            color: #6B8EFF;
            font-size: 24px;
            margin-bottom: 15px;
        }
        h2 {
            color: #8E6BFF;
            font-size: 18px;
            margin: 15px 0 10px;
        }
        p, li {
            font-size: 14px;
            line-height: 1.2;
            color: #333333;
            margin-bottom: 5px;
        }
        ul {
            padding-left: 20px;
        }
        .highlight {
            background-color: rgba(107, 142, 255, 0.3);
            padding: 0.1em 0.3em;
            border-radius: 3px;
        }
        .code-block {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            font-family: Consolas, Monaco, "Courier New", monospace;
            font-size: 13px;
            line-height: 1.5;
            margin: 5px 0;
            white-space: pre;
        }
        .warning {
            background-color: rgba(255, 223, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .memory-model {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
        }
        .cpu {
            width: 80px;
            text-align: center;
        }
        .cpu-core {
            background: #E6F3FF;
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        .main-memory {
            flex: 1;
            background: #C1E1FF;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
        }
        .barrier {
            background: #FF6B6B;
            color: white;
            padding: 5px;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
            margin: 5px 0;
        }
    </style>
</head>
<body>
<!-- å°é¢å¡ -->
<div class="card">
    <div class="header"></div>
    <div class="content" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: linear-gradient(135deg, #6B8EFF, #8E6BFF);">
        <h1 style="color: white; font-size: 28px; text-align: center;">é¢è¯•å¿…é—®ï¼švolatileå…³é”®å­—</h1>
        <p style="color: white; text-align: center; font-size: 16px;">Javaå¹¶å‘ç¼–ç¨‹çš„è½»é‡çº§åŒæ­¥</p>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>

<!-- å¡ç‰‡1ï¼šå¯è§æ€§ä¿è¯ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>å¯è§æ€§ä¿è¯</h1>

        <div class="memory-model">
            <div class="cpu">
                <div class="cpu-core">CPU1</div>
                <div>æœ¬åœ°ç¼“å­˜</div>
            </div>
            <div class="main-memory">
                volatileå˜é‡
            </div>
            <div class="cpu">
                <div class="cpu-core">CPU2</div>
                <div>æœ¬åœ°ç¼“å­˜</div>
            </div>
        </div>

        <h2>å·¥ä½œæœºåˆ¶</h2>
        <ul>
            <li><span class="highlight">å†™æ“ä½œ</span>ï¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜</li>
            <li><span class="highlight">è¯»æ“ä½œ</span>ï¼šç›´æ¥ä»ä¸»å†…å­˜è¯»å–</li>
            <li>åŸºäºMESIç­‰ç¼“å­˜ä¸€è‡´æ€§åè®®</li>
        </ul>

        <div class="warning">
            âš ï¸ æ™®é€šå˜é‡å¯èƒ½è¯»å–åˆ°çº¿ç¨‹æœ¬åœ°ç¼“å­˜çš„æ—§å€¼
        </div>

        <div class="code-block">// çº¿ç¨‹A
flag = true; // ç«‹å³å†™å…¥ä¸»å†…å­˜

// çº¿ç¨‹B
if (flag) {  // ä»ä¸»å†…å­˜è¯»å–æœ€æ–°å€¼
// ä¿è¯çœ‹åˆ°true
}</div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>

<!-- å¡ç‰‡2ï¼šæœ‰åºæ€§ä¿è¯ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>æœ‰åºæ€§ä¿è¯</h1>

        <h2>Happens-BeforeåŸåˆ™</h2>
        <p>å¯¹volatileå˜é‡çš„å†™æ“ä½œ<span class="highlight">happens-before</span>åç»­æ‰€æœ‰è¯»æ“ä½œ</p>

        <div class="barrier">StoreStoreå±éšœ</div>
        <p>ç¦æ­¢æ™®é€šå†™ä¸volatileå†™é‡æ’åº</p>

        <div class="barrier">StoreLoadå±éšœ</div>
        <p>ç¦æ­¢volatileå†™ä¸åç»­æ“ä½œé‡æ’åº</p>

        <div class="barrier">LoadLoadå±éšœ</div>
        <p>ç¦æ­¢volatileè¯»ä¸åç»­è¯»æ“ä½œé‡æ’åº</p>

        <div class="barrier">LoadStoreå±éšœ</div>
        <p>ç¦æ­¢volatileè¯»ä¸åç»­å†™æ“ä½œé‡æ’åº</p>


    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>

<!-- å¡ç‰‡3ï¼šå†…å­˜å±éšœ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>å†…å­˜å±éšœæœºåˆ¶</h1>

        <h2>JVMå±‚é¢</h2>
        <p>æ’å…¥ç‰¹å®šå†…å­˜å±éšœæŒ‡ä»¤ï¼š</p>
        <ul>
            <li>x86: lockå‰ç¼€æŒ‡ä»¤æˆ–mfence</li>
            <li>ARM: dmb/dsbæŒ‡ä»¤</li>
        </ul>

        <h2>ç¡¬ä»¶å±‚é¢</h2>
        <p>ä¾èµ–CPUçš„ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼š</p>
        <ul>
            <li>MESI (Intel)</li>
            <li>MOESI (AMD)</li>
        </ul>

        <div class="warning">
            ğŸ’¡ ä¸åŒCPUæ¶æ„çš„å†…å­˜å±éšœå®ç°ä¸åŒ<br>
            JVMä¼šæ ¹æ®å¹³å°è‡ªåŠ¨é€‰æ‹©
        </div>


    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>

<!-- å¡ç‰‡4ï¼šä½¿ç”¨åœºæ™¯ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>å…¸å‹ä½¿ç”¨åœºæ™¯</h1>

        <h2>1. çŠ¶æ€æ ‡å¿—ä½</h2>
        <div class="code-block">
private volatile boolean shutdown;

public void shutdown() {
    shutdown = true; // æ‰€æœ‰çº¿ç¨‹ç«‹å³å¯è§
}

public void doWork() {
    while (!shutdown) {
        // æ­£å¸¸å·¥ä½œ
    }
}
        </div>

    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>
<!-- å¡ç‰‡4ï¼šä½¿ç”¨åœºæ™¯ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>å…¸å‹ä½¿ç”¨åœºæ™¯</h1>

        <h2>2. åŒé‡æ£€æŸ¥é”å®š</h2>
        <div class="code-block">
private static volatile Singleton instance;

public static Singleton getInstance() {
    if (instance == null) {          // ç¬¬ä¸€æ¬¡æ£€æŸ¥
        synchronized (Singleton.class) {
            if (instance == null) {  // ç¬¬äºŒæ¬¡æ£€æŸ¥
                instance = new Singleton();
            }
        }
    }
    return instance;
}
        </div>

        <div class="warning">
            âœ… volatileé˜²æ­¢æŒ‡ä»¤é‡æ’åº<br>
            é¿å…è¿”å›æœªåˆå§‹åŒ–çš„å®ä¾‹
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>

<!-- å¡ç‰‡5ï¼šæ³¨æ„äº‹é¡¹ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>æ³¨æ„äº‹é¡¹</h1>

        <h2>ä¸ä¿è¯åŸå­æ€§</h2>
        <p>å¤åˆæ“ä½œä»éœ€åŒæ­¥</p>

        <h2>æ€§èƒ½å½±å“</h2>
        <ul>
            <li>æ¯”æ™®é€šå˜é‡è®¿é—®æ…¢</li>
            <li>ä½†æ¯”synchronizedå¿«</li>
            <li>é¿å…è¿‡åº¦ä½¿ç”¨</li>
        </ul>

        <h2>ä¸é€‚ç”¨åœºæ™¯</h2>
        <ul>
            <li>å¤šæ­¥éª¤çš„å¤åˆæ“ä½œ</li>
            <li>éœ€è¦äº’æ–¥è®¿é—®çš„ä¸´ç•ŒåŒº</li>
        </ul>

        <div class="warning">
            âš ï¸ volatileä¸èƒ½æ›¿ä»£synchronized<br>
            ä»…é€‚ç”¨äºç‰¹å®šåœºæ™¯
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>

<!-- å¡ç‰‡6ï¼šä¸synchronizedå¯¹æ¯” -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ä¸synchronizedå¯¹æ¯”</h1>

        <table style="width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 13px;">
            <tr>
                <th style="border: 1px solid #ddd; padding: 8px;">ç‰¹æ€§</th>
                <th style="border: 1px solid #ddd; padding: 8px;">volatile</th>
                <th style="border: 1px solid #ddd; padding: 8px;">synchronized</th>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">å¯è§æ€§</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âœ”ï¸</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âœ”ï¸</td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">æœ‰åºæ€§</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âœ”ï¸</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âœ”ï¸</td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">åŸå­æ€§</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âŒ</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âœ”ï¸</td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">é˜»å¡</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âŒ</td>
                <td style="border: 1px solid #ddd; padding: 8px;">âœ”ï¸</td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">æ€§èƒ½</td>
                <td style="border: 1px solid #ddd; padding: 8px;">è¾ƒé«˜</td>
                <td style="border: 1px solid #ddd; padding: 8px;">è¾ƒä½</td>
            </tr>
        </table>

        <h2>é€‰æ‹©å»ºè®®</h2>
        <ul>
            <li>å•å˜é‡çŠ¶æ€æ ‡å¿— â†’ volatile</li>
            <li>å¤åˆæ“ä½œ â†’ synchronizedæˆ–Atomicç±»</li>
            <li>éœ€è¦äº’æ–¥è®¿é—® â†’ synchronized</li>
        </ul>

        <div class="code-block">// æ ¹æ®åœºæ™¯é€‰æ‹©ï¼š
// 1. ä»…éœ€å¯è§æ€§ï¼švolatile
// 2. éœ€è¦åŸå­æ€§ï¼šAtomicXXX
// 3. éœ€è¦äº’æ–¥ï¼šsynchronized</div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Java</div>
</div>
</body>
</html>