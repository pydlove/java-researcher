<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢¨å¢¨è¯´-æ—¥å¿—CPUé—®é¢˜æ’æŸ¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        body {
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            background-color: #F0FFF5;
            justify-content: center;
        }
        .card {
            width: 450px;
            height: 600px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .header {
            height: 20px;
            background: linear-gradient(90deg, #FF6B6B, #FF8E53);
            position: relative;
        }
        .header::before {
            content: "";
            position: absolute;
            width: 10px;
            height: 20px;
            background: #6BFF8E;
            border-radius: 0 5px 5px 0;
        }
        .content {
            padding: 20px;
            flex: 1;
            overflow: hidden;
        }
        .footer {
            height: 60px;
            background: linear-gradient(90deg, #FF6B6B, #FF8E53);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        h1 {
            color: #FF6B6B;
            font-size: 24px;
            margin-bottom: 15px;
        }
        h2 {
            color: #FF8E53;
            font-size: 18px;
            margin: 15px 0 10px;
        }
        p, li {
            font-size: 14px;
            line-height: 1.6;
            color: #333333;
            margin-bottom: 10px;
        }
        ul {
            padding-left: 20px;
        }
        .highlight {
            background-color: rgba(255, 107, 107, 0.3);
            padding: 0.1em 0.3em;
            border-radius: 3px;
        }
        .code-block {
            background: #f5f5f5;
            padding: 5px;
            border-radius: 6px;
            font-family: Consolas, Monaco, "Courier New", monospace;
            font-size: 12px;
            line-height: 1.5;
            margin: 10px 0;
            white-space: pre;
        }
        .warning {
            background-color: rgba(255, 223, 0, 0.3);
            padding: 5px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .danger {
            background-color: rgba(255, 107, 107, 0.2);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #FF6B6B;
        }
        .success {
            background-color: rgba(107, 255, 142, 0.3);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .step-flow {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
        }
        .step {
            width: 90%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            text-align: center;
            background: #F0F8FF;
        }
        .arrow {
            margin: 2px 0;
            color: #FF6B6B;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 12px;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f2f2f2;
        }
        .tool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        .tool-item {
            background: #F5F5F5;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
    </style>
</head>
<body>
<!-- å°é¢å¡ -->
<div class="card">
    <div class="header"></div>
    <div class="content" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: linear-gradient(135deg, #FF6B6B, #FF8E53);">
        <h1 style="color: white; font-size: 28px; text-align: center;">é¢è¯•åœºæ™¯é¢˜ï¼šæ—¥å¿—æ‰“å°ç«Ÿè®©CPUé£™åˆ°100%</h1>
        <p style="color: white; text-align: center; font-size: 16px;">Javaæ€§èƒ½é—®é¢˜è¯Šæ–­æŒ‡å—</p>
        <div class="code-block" style="background: rgba(255,255,255,0.2); color: white;">
            // å¸¸è§é—®é¢˜ä»£ç <br>
            logger.debug("User: {}", user);<br>
            // ç”Ÿäº§ç¯å¢ƒDEBUGçº§åˆ«å¯¼è‡´CPUé£™å‡
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>

<!-- å¡ç‰‡1ï¼šå¸¸è§åŸå› åˆ†æ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>å¸¸è§åŸå› åˆ†æ</h1>

        <h2>1. æ—¥å¿—çº§åˆ«è®¾ç½®ä¸å½“</h2>
        <p>ç”Ÿäº§ç¯å¢ƒä½¿ç”¨<span class="highlight">DEBUG/TRACE</span>çº§åˆ«ï¼š</p>
        <div class="code-block">// ç”Ÿäº§ç¯å¢ƒé”™è¯¯é…ç½®ï¼Œåº”è¯¥ä¸ºINFOæˆ–WARN
&ltroot level="DEBUG"&gt &ltappender-ref ref="FILE" /&gt &lt/root&gt</div>

        <h2>2. åŒæ­¥æ—¥å¿—é˜»å¡</h2>
        <p>é«˜å¹¶å‘ä¸‹åŒæ­¥æ—¥å¿—å¯¼è‡´çº¿ç¨‹å †ç§¯ï¼š</p>
        <div class="code-block">// åŒæ­¥æ—¥å¿—åœ¨é«˜å¹¶å‘ä¸‹çš„é—®é¢˜
logger.info("Processing request"); // é˜»å¡ç‚¹
// ä¸šåŠ¡é€»è¾‘</div>

        <h2>3. æ—¥å¿—æ ¼å¼å¤æ‚</h2>
        <p>åŒ…å«<span class="highlight">è€—æ—¶è®¡ç®—</span>çš„æ¨¡å¼ï¼š</p>
<div class="code-block">%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} [%file:%line] %msg%n
    // æ¯æ¬¡è°ƒç”¨éƒ½è®¡ç®—æ–‡ä»¶åå’Œè¡Œå·</div>

        <div class="danger">
            âš ï¸ å•ä¸ªé—®é¢˜å¯èƒ½ä¸æ˜æ˜¾ï¼Œç»„åˆå‡ºç°æ—¶CPUé£™å‡æ˜æ˜¾
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>

<!-- å¡ç‰‡2ï¼šæ’æŸ¥æ­¥éª¤ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ç³»ç»ŸåŒ–æ’æŸ¥æ­¥éª¤</h1>

        <div class="step-flow">
            <div class="step">1. ç¡®è®¤CPUé«˜è´Ÿè½½</div>
            <div class="arrow">â†“</div>
            <div class="step">2. çº¿ç¨‹åˆ†æå®šä½é—®é¢˜</div>
            <div class="arrow">â†“</div>
            <div class="step">3. æ—¥å¿—é…ç½®æ£€æŸ¥</div>
            <div class="arrow">â†“</div>
            <div class="step">4. ä»£ç å®¡æŸ¥ä¼˜åŒ–</div>
        </div>

        <h2>æ­¥éª¤1ï¼šç¡®è®¤CPUè´Ÿè½½</h2>
        <div class="code-block">
# æŸ¥çœ‹Javaè¿›ç¨‹CPUä½¿ç”¨
top -p <pid>

# æŸ¥çœ‹çº¿ç¨‹çº§åˆ«CPUä½¿ç”¨
top -H -p <pid>

# å¿«é€Ÿå®šä½é«˜CPUçº¿ç¨‹
ps -eLo pid,lwp,pcpu | grep <pid>
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>
<!-- å¡ç‰‡2ï¼šæ’æŸ¥æ­¥éª¤ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ç³»ç»ŸåŒ–æ’æŸ¥æ­¥éª¤</h1>

        <h2>æ­¥éª¤2ï¼šçº¿ç¨‹åˆ†æå·¥å…·</h2>
        <div class="tool-grid">
            <div class="tool-item">
                <strong>jstack</strong><br>
                çº¿ç¨‹è½¬å‚¨åˆ†æ
            </div>
            <div class="tool-item">
                <strong>Arthas</strong><br>
                åœ¨çº¿è¯Šæ–­å·¥å…·
            </div>
            <div class="tool-item">
                <strong>VisualVM</strong><br>
                å›¾å½¢åŒ–ç›‘æ§
            </div>
            <div class="tool-item">
                <strong>async-profiler</strong><br>
                æ€§èƒ½å‰–æ
            </div>
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>

<!-- å¡ç‰‡3ï¼šçº¿ç¨‹åˆ†æå®æˆ˜ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>çº¿ç¨‹åˆ†æå®æˆ˜</h1>

        <h2>jstackçº¿ç¨‹è½¬å‚¨åˆ†æ</h2>
        <div class="code-block"># ç”Ÿæˆçº¿ç¨‹è½¬å‚¨
jstack pid > thread_dump.txt

# æŸ¥æ‰¾æ—¥å¿—ç›¸å…³çº¿ç¨‹
grep -A 10 -B 2 "Log4j2\|Logback\|Logger" thread_dump.txt

# ç¤ºä¾‹è¾“å‡ºï¼š
"http-nio-8080-exec-1" #32 daemon prio=5
java.lang.Thread.State: RUNNABLE
at ch.qos.logback.core.OutputStreamAppender.writeBytes
at ch.qos.logback.core.FileAppender.subAppend</div>

        <h2>Arthaså®æ—¶è¯Šæ–­</h2>
        <div class="code-block"># å¯åŠ¨Arthas
java -jar arthas-boot.jar

# æŸ¥çœ‹æœ€å¿™çš„çº¿ç¨‹
thread -n 3

# ç›‘æ§ç‰¹å®šæ–¹æ³•è°ƒç”¨
watch org.slf4j.Logger info params</div>

    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>

<!-- å¡ç‰‡5ï¼šä»£ç çº§ä¼˜åŒ– -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ä»£ç çº§ä¼˜åŒ–æŠ€å·§</h1>

        <h2>1. é¿å…ä¸å¿…è¦çš„æ—¥å¿—è°ƒç”¨</h2>
        <div class="code-block">
// é”™è¯¯å†™æ³•ï¼šå³ä½¿ä¸è¾“å‡ºä¹Ÿä¼šè®¡ç®—å‚æ•°
logger.debug("Processed {} records", expensiveCount());

// æ­£ç¡®å†™æ³•ï¼šå…ˆåˆ¤æ–­çº§åˆ«
if (logger.isDebugEnabled()) {
logger.debug("Processed {} records", expensiveCount());
}

// Java 8+ lambdaå†™æ³•ï¼ˆå»¶è¿Ÿè®¡ç®—ï¼‰
logger.debug("Processed {} records",
() -> expensiveCount());
        </div>


    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>
<!-- å¡ç‰‡5ï¼šä»£ç çº§ä¼˜åŒ– -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ä»£ç çº§ä¼˜åŒ–æŠ€å·§</h1>

        <h2>2. æ§åˆ¶æ—¥å¿—å†…å®¹</h2>
        <div class="code-block">
// é¿å…æ‰“å°å¤§å¯¹è±¡
User user = getUserById(123);

// é”™è¯¯ï¼šå¯èƒ½è°ƒç”¨toString()æ‰“å°æ•´ä¸ªå¯¹è±¡
logger.info("User login: {}", user);

// æ­£ç¡®ï¼šåªæ‰“å°å¿…è¦å­—æ®µ
logger.info("User login: name={}, id={}",
user.getName(), user.getId());

// ç‰¹åˆ«é¿å…é›†åˆçš„å®Œæ•´æ‰“å°
logger.debug("All users: {}", userList); // å¯èƒ½å¾ˆå¤§ï¼
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>


<!-- å¡ç‰‡5ï¼šä»£ç çº§ä¼˜åŒ– -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ä»£ç çº§ä¼˜åŒ–æŠ€å·§</h1>

        <h2>3. é«˜é¢‘æ—¥å¿—é™æµ</h2>
        <div class="code-block">
public class RateLimitedLogger {
private long lastLogTime = 0;
private static final long INTERVAL = 5000; // 5ç§’

public void warnIfNeeded(String message) {
    long current = System.currentTimeMillis();
        if (current - lastLogTime > INTERVAL) {
            logger.warn(message);
            lastLogTime = current;
        }
    }
}
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>
<!-- å¡ç‰‡6ï¼šç›‘æ§ä¸é¢„é˜² -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>ç›‘æ§ä¸é¢„é˜²æªæ–½</h1>

        <h2>æ—¥å¿—ç³»ç»Ÿç›‘æ§æŒ‡æ ‡</h2>
        <ul>
            <li><span class="highlight">æ—¥å¿—è¾“å‡ºé€Ÿç‡</span>ï¼šæ¡æ•°/ç§’</li>
            <li><span class="highlight">æ—¥å¿—æ–‡ä»¶å¤§å°</span>ï¼šå•æ–‡ä»¶ä¸è¶…è¿‡100MB</li>
            <li><span class="highlight">æ—¥å¿—é˜Ÿåˆ—é•¿åº¦</span>ï¼šå¼‚æ­¥æ—¥å¿—çš„å †ç§¯æƒ…å†µ</li>
            <li><span class="highlight">I/Oç­‰å¾…æ—¶é—´</span>ï¼šæ—¥å¿—å†™å…¥æ€§èƒ½</li>
        </ul>

        <h2>é¢„é˜²æ€§æ£€æŸ¥æ¸…å•</h2>
        <div class="code-block">
            âœ… ç”Ÿäº§ç¯å¢ƒæ—¥å¿—çº§åˆ«æ˜¯å¦ä¸ºINFOåŠä»¥ä¸Š
            âœ… ä½¿ç”¨å¼‚æ­¥æ—¥å¿—Appender
            âœ… æ—¥å¿—æ¨¡å¼æ˜¯å¦ç®€åŒ–ï¼ˆå»æ‰è¡Œå·ç­‰ï¼‰
            âœ… å¾ªç¯å†…æ˜¯å¦æœ‰æ—¥å¿—è°ƒç”¨
            âœ… æ˜¯å¦é¿å…æ‰“å°å¤§å¯¹è±¡
            âœ… æ˜¯å¦æœ‰æ—¥å¿—æ–‡ä»¶æ»šåŠ¨ç­–ç•¥
            âœ… æ˜¯å¦ç›‘æ§æ—¥å¿—æ–‡ä»¶å¤§å°
        </div>

        <div class="success">
            ğŸ¯ å®šæœŸè¿›è¡Œä»£ç å®¡æŸ¥å’Œæ€§èƒ½æµ‹è¯•ï¼Œ<br>
            æå‰å‘ç°æ½œåœ¨çš„æ€§èƒ½é—®é¢˜
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>

<!-- å¡ç‰‡7ï¼šé«˜çº§è¯Šæ–­æŠ€å·§ -->
<div class="card">
    <div class="header"></div>
    <div class="content">
        <h1>é«˜çº§è¯Šæ–­æŠ€å·§</h1>

        <h2>1. ä½¿ç”¨JMXç›‘æ§</h2>

        <h2>2. æ€§èƒ½å‰–æå·¥å…·</h2>

        <h2>3. æ—¥å¿—æ¡†æ¶ç‰¹å®šä¼˜åŒ–</h2>
        <table class="comparison-table">
            <tr>
                <th>æ¡†æ¶</th>
                <th>ä¼˜åŒ–å‚æ•°</th>
                <th>æ•ˆæœ</th>
            </tr>
            <tr>
                <td>Logback</td>
                <td>immediateFlush=false</td>
                <td>å‡å°‘I/Oæ¬¡æ•°</td>
            </tr>
            <tr>
                <td>Log4j2</td>
                <td>bufferSize=8192</td>
                <td>ä¼˜åŒ–ç¼“å†²åŒº</td>
            </tr>
            <tr>
                <td>æ‰€æœ‰æ¡†æ¶</td>
                <td>includeLocation=false</td>
                <td>é¿å…è®¡ç®—è¡Œå·</td>
            </tr>
        </table>

        <div class="warning">
            ğŸ’¡ ä¸åŒæ—¥å¿—æ¡†æ¶ä¼˜åŒ–å‚æ•°ä¸åŒï¼Œ<br>
            éœ€æ ¹æ®å®é™…ä½¿ç”¨çš„æ¡†æ¶è¿›è¡Œè°ƒæ•´
        </div>
    </div>
    <div class="footer">å¢¨å¢¨è¯´-Javaæ€§èƒ½</div>
</div>
</body>
</html>