<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>布隆过滤器内存计算器</title>
    <style>
        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #F0F8FF;
            color: #333333;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            margin: 0;
        }

        .card {
            width: 450px;
            height: 600px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .top-decoration {
            height: 20px;
            background: linear-gradient(90deg, #FF9A8B, #FF6B6B, #FF8E53);
            display: flex;
            justify-content: space-between;
            padding: 0 15px;
        }

        .ring {
            width: 12px;
            height: 12px;
            background-color: #fff;
            border-radius: 50%;
            margin-top: 4px;
        }

        .content-area {
            flex: 1;
            padding: 20px;
            overflow: hidden;
        }

        .bottom-area {
            height: 60px;
            background: linear-gradient(90deg, #FF9A8B, #FF6B6B);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        h1 {
            font-size: 24px;
            color: #1A1A1A;
            margin-top: 0;
            margin-bottom: 15px;
        }

        h2 {
            font-size: 18px;
            color: #2B2B2B;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .highlight {
            background-color: rgba(255, 223, 0, 0.5);
            padding: 0.1em 0.3em;
            border-radius: 3px;
        }

        .code-block {
            background-color: #F8F9FA;
            border-left: 4px solid #FF6B6B;
            padding: 12px;
            font-family: Consolas, Monaco, "Courier New", monospace;
            font-size: 13px;
            line-height: 1.5;
            overflow: hidden;
            margin: 15px 0;
            white-space: pre-wrap;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }

        .table th, .table td {
            border: 1px solid #E0E0E0;
            padding: 8px;
            text-align: center;
        }

        .table th {
            background-color: rgba(255, 154, 139, 0.1);
        }

        .continue-hint {
            text-align: center;
            color: #FF6B6B;
            font-weight: bold;
            margin-top: 10px;
        }

        /* 封面特定样式 */
        .cover-card {
            background: linear-gradient(135deg, #FF9A8B 0%, #FF6B6B 50%, #FF8E53 100%);
        }

        .cover-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
            padding: 40px 30px;
            color: white;
        }

        .cover-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            line-height: 1.3;
        }

        .cover-subtitle {
            font-size: 20px;
            margin-bottom: 40px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: 12px;
        }

        .cover-highlight {
            background-color: rgba(255, 223, 0, 0.7);
            padding: 0.2em 0.5em;
            border-radius: 5px;
            color: #1A1A1A;
        }

        .cover-tag {
            margin-top: 40px;
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
        }
    </style>
</head>
<body>
<!-- 封面卡片 -->
<div class="card cover-card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="cover-content">
        <div class="cover-title">面试被问！</div>
        <div class="cover-title" style="font-size: 24px">布隆过滤器1亿数据要多少内存？</div>
        <div class="cover-subtitle">布隆过滤器空间优化逻辑</div>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- 核心公式卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>核心估算公式</h1>
        <p>布隆过滤器所需的内存大小（比特数，m）由以下公式决定：</p>

        <div class="code-block">
m = - (n * ln(p)) / (ln(2))²

其中：
● n = 预期要插入的元素数量
● p = 可接受的误判率 (False Positive Rate)
● m = 所需的最小比特数 (bit)
        </div>

        <p>得到比特数 m后，除以 8 即可得到字节数，再除以 1024^2 可得到MB单位的大小。</p>

        <p>对于<span class="highlight">1亿条数据</span>（n = 100,000,000），我们计算不同误判率下的内存需求。</p>

        <div class="continue-hint">↓ 继续查看详细计算 ↓</div>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- 场景一卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>场景一：标准误判率 (1%)</h1>
        <p>这是最常用的配置，在内存空间和准确性之间取得了很好的平衡。</p>

        <div class="code-block">
计算比特数 m:
m = - (100,000,000 * ln(0.01)) / (ln(2))²

ln(0.01) ≈ -4.60517
(ln(2))² ≈ (0.693147)² ≈ 0.480453

m = - [100,000,000 * (-4.60517)] / 0.480453
= 460,517,000 / 0.480453
≈ 958,505,000 bits
        </div>

        <p>换算为内存大小:</p>
        <ul>
            <li>字节数: 958,505,000 / 8 ≈ <span class="highlight">119,813,000 Bytes</span></li>
            <li>MB: 119,813,000 / (1024 * 1024) ≈ <span class="highlight">114.25 MB</span></li>
        </ul>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- 场景二卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>场景二：较低误判率 (0.1%)</h1>
        <p>适用于对准确性要求极高的场景。</p>

        <div class="code-block">
计算比特数 m:
m = - (100,000,000 * ln(0.001)) / (ln(2))²

ln(0.001) ≈ -6.90776

m = - [100,000,000 * (-6.90776)] / 0.480453
= 690,776,000 / 0.480453
≈ 1,437,000,000 bits
        </div>

        <p>换算为内存大小:</p>
        <ul>
            <li>字节数: 1,437,000,000 / 8 ≈ <span class="highlight">179,625,000 Bytes</span></li>
            <li>MB: 179,625,000 / (1024 * 1024) ≈ <span class="highlight">171.33 MB</span></li>
        </ul>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- 场景三卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>场景三：较高误判率 (3%)</h1>
        <p>适用于内存空间非常紧张，可以容忍稍高误判率的场景。</p>

        <div class="code-block">
计算比特数 m:
m = - (100,000,000 * ln(0.03)) / (ln(2))²

ln(0.03) ≈ -3.50656

m = - [100,000,000 * (-3.50656)] / 0.480453
= 350,656,000 / 0.480453
≈ 729,700,000 bits
        </div>

        <p>换算为内存大小:</p>
        <ul>
            <li>字节数: 729,700,000 / 8 ≈ <span class="highlight">91,212,500 Bytes</span></li>
            <li>MB: 91,212,500 / (1024 * 1024) ≈ <span class="highlight">87.00 MB</span></li>
        </ul>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- 总结表格卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>内存需求总结</h1>
        <p>不同误判率下的内存需求对比：</p>

        <table class="table">
            <tr>
                <th>误判率 (p)</th>
                <th>所需比特数 (m)</th>
                <th>所需内存大小 (约)</th>
                <th>适用场景</th>
            </tr>
            <tr>
                <td>1% (0.01)</td>
                <td>~958 million</td>
                <td>114 MB</td>
                <td>标准配置，平衡型</td>
            </tr>
            <tr>
                <td>0.1% (0.001)</td>
                <td>~1.437 billion</td>
                <td>171 MB</td>
                <td>高精度，低误判需求</td>
            </tr>
            <tr>
                <td>3% (0.03)</td>
                <td>~730 million</td>
                <td>87 MB</td>
                <td>内存敏感，可接受较高误判</td>
            </tr>
        </table>

        <p class="highlight">关键结论：对于1亿条数据，布隆过滤器的内存需求大致在90MB到170MB之间</p>

        <div class="continue-hint">↓ Java实现示例 ↓</div>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- Java实现卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>Java实现示例</h1>
        <p>使用Google Guava库创建布隆过滤器：</p>

        <div class="code-block">import com.google.common.hash.BloomFilter;
import com.google.common.hash.Funnels;

public class BloomFilterExample {
    public static void main(String[] args) {
        // 创建处理String类型的布隆过滤器
        // 预期插入1亿条数据，误判率为1%
        BloomFilter<String> bloomFilter = BloomFilter.create(
            Funnels.unencodedCharsFunnel(),
            100_000_000,
            0.01
        );

        bloomFilter.put("www.example.com");
        if (bloomFilter.mightContain("aaa")) {
            System.out.println("可能存在");
        }
    }
}</div>

    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>

<!-- 总结卡片 -->
<div class="card">
    <div class="top-decoration">
        <div class="ring"></div>
        <div class="ring"></div>
    </div>
    <div class="content-area">
        <h1>核心要点总结</h1>

        <p>✅ 布隆过滤器以<span class="highlight">极小内存</span>处理海量数据</p>
        <p>✅ 1亿数据仅需约<span class="highlight">114MB</span>内存(1%误判率)</p>
        <p>✅ 内存需求与误判率<span class="highlight">负相关</span></p>
        <p>✅ 使用成熟库(如Guava)自动计算参数</p>
        <p>✅ 实际内存略大于理论值(因实现细节)</p>

        <h2>适用场景</h2>
        <p>✔ 缓存穿透防护</p>
        <p>✔ 大规模数据初步过滤</p>
        <p>✔ 爬虫URL去重</p>
        <p>✔ 垃圾邮件过滤</p>

        <div style="text-align: center; margin-top: 20px;">
            <p style="color: #FF6B6B; font-weight: bold;">关注"墨墨说-Java"获取更多技术干货</p>
        </div>
    </div>
    <div class="bottom-area">
        墨墨说-Java · 算法优化系列
    </div>
</div>
</body>
</html>